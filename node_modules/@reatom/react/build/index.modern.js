import{createContext as t,useReducer as e,useContext as o,useRef as r,useEffect as s,useCallback as u}from"react";function n(){}const a=t(null),{Provider:c}=a,i=t=>t;function l(t=a){return function(u,a=i,c=[]){const l=e(t=>t+1,0)[1],m=o(t);if(!m)throw new Error("[reatom] The provider is not defined");const{current:f}=r({store:m,atom:void 0,selector:a,deps:c,atomValue:void 0,selectorValue:void 0,unsubscribe:n,mountStatus:"init"});if(f.selector=a,m!==f.store||u!==f.atom)f.store=m,f.atom=u,f.deps=c,f.unsubscribe(),f.unsubscribe=m.subscribe(f.atom,t=>{if(Object.is(f.atomValue,t))return;f.atomValue=t;const e=f.selector(t);Object.is(e,f.selectorValue)||(f.selectorValue=e,"init"===f.mountStatus?f.mountStatus="outOfDate":l())}),f.atomValue=f.store.getState(u),f.selectorValue=f.selector(f.atomValue);else{const t=f.store.getState(f.atom);Object.is(t,f.atomValue)&&c.length===f.deps.length&&!c.some((t,e)=>!Object.is(t,f.deps[e]))||(f.deps=c,f.atomValue=t,f.selectorValue=f.selector(f.atomValue))}return s(()=>("outOfDate"===f.mountStatus&&(f.mountStatus="upToDate",l()),f.mountStatus="upToDate",()=>f.unsubscribe()),[]),f.selectorValue}}const m=l();function f(t=a){return function(e,r=[]){const s=o(t);if(!s)throw new Error("[reatom] The provider is not defined");if("function"!=typeof e)throw new TypeError("[reatom] `useAction` argument must be a function");return u((...t)=>{const o=e(...t);o&&s.dispatch(o)},r.concat(s))}}const d=f();export{c as Provider,a as context,f as createActionHook,l as createAtomHook,d as useAction,m as useAtom};
//# sourceMappingURL=index.modern.js.map
