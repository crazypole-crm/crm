import{createContext as t,useReducer as e,useContext as o,useRef as r,useEffect as u,useCallback as n}from"react";function a(){}var i=t(null),s=i.Provider,c=function(t){return t};function l(t){return void 0===t&&(t=i),function(n,i,s){void 0===i&&(i=c),void 0===s&&(s=[]);var l=e(function(t){return t+1},0)[1],m=o(t);if(!m)throw new Error("[reatom] The provider is not defined");var f=r({store:m,atom:void 0,selector:i,deps:s,atomValue:void 0,selectorValue:void 0,unsubscribe:a,mountStatus:"init"}).current;if(f.selector=i,m!==f.store||n!==f.atom)f.store=m,f.atom=n,f.deps=s,f.unsubscribe(),f.unsubscribe=m.subscribe(f.atom,function(t){if(!Object.is(f.atomValue,t)){f.atomValue=t;var e=f.selector(t);Object.is(e,f.selectorValue)||(f.selectorValue=e,"init"===f.mountStatus?f.mountStatus="outOfDate":l())}}),f.atomValue=f.store.getState(n),f.selectorValue=f.selector(f.atomValue);else{var d=f.store.getState(f.atom);Object.is(d,f.atomValue)&&s.length===f.deps.length&&!s.some(function(t,e){return!Object.is(t,f.deps[e])})||(f.deps=s,f.atomValue=d,f.selectorValue=f.selector(f.atomValue))}return u(function(){return"outOfDate"===f.mountStatus&&(f.mountStatus="upToDate",l()),f.mountStatus="upToDate",function(){return f.unsubscribe()}},[]),f.selectorValue}}var m=l();function f(t){return void 0===t&&(t=i),function(e,r){void 0===r&&(r=[]);var u=o(t);if(!u)throw new Error("[reatom] The provider is not defined");if("function"!=typeof e)throw new TypeError("[reatom] `useAction` argument must be a function");return n(function(){var t=e.apply(void 0,[].slice.call(arguments));t&&u.dispatch(t)},r.concat(u))}}var d=f();export{s as Provider,i as context,f as createActionHook,l as createAtomHook,d as useAction,m as useAtom};
//# sourceMappingURL=index.es.js.map
